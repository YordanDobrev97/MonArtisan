@{
    Layout = null;
}

<head>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
            crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"
            integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU="
            crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css" integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous" />
    <link rel="stylesheet" href="~/css/chat.css" />
    <script src="~/lib/signalr/dist/browser/signalr.min.js"></script>
</head>

<div class="chat-container">
    <aside class="chat-aside">
        <div class="chat-user">
            <img class="chat-user-image" src="https://icons-for-free.com/iconfiles/png/512/person-1324760545186718018.png" />
            <h2>Username</h2>
        </div>

        <div class="chat-user">
            <img class="chat-user-image" src="https://icons-for-free.com/iconfiles/png/512/person-1324760545186718018.png" />
            <h2>Username</h2>
        </div>

        <div class="chat-user">
            <img class="chat-user-image" src="https://icons-for-free.com/iconfiles/png/512/person-1324760545186718018.png" />
            <h2>Username</h2>
        </div>

        <div class="chat-user">
            <img class="chat-user-image" src="https://icons-for-free.com/iconfiles/png/512/person-1324760545186718018.png" />
            <h2>Username</h2>
        </div>

        <div class="chat-user">
            <img class="chat-user-image" src="https://icons-for-free.com/iconfiles/png/512/person-1324760545186718018.png" />
            <h2>Username</h2>
        </div>

        <div>
            <a style="color: white; margin: 50px;" asp-area="" asp-controller="Clients" asp-action="Index">Main Page</a>
        </div>

        <div class="pagination-btns">
            <button>
                <i class="fas fa-angle-left"></i>
            </button>
            <button>
                <i class="fas fa-angle-right"></i>
            </button>
        </div>
    </aside>

    <div class="main-chat">
        <header class="chat-header">
            <img class="chat-user-image" src="https://icons-for-free.com/iconfiles/png/512/person-1324760545186718018.png" />
            <h2>Username</h2>
        </header>

        <main class="messages">
            <div class="container-message">

            </div>

            <div class="send-message-container">
                <input type="text" class="textarea" placeholder="your message" />
                <button id="sendButton" class="send-message-btn">
                    <i class="fa fa-paper-plane" aria-hidden="true"></i>
                </button>
            </div>
        </main>
    </div>
</div>

<script>
    var connection =
        new signalR.HubConnectionBuilder()
            .withUrl("/messenger")
            .build();

    connection.on("NewMessage",
        function (message) {
            const container = $('.container-message');
            const chatMessage = document.createElement('div');
            chatMessage.textContent = `${escapeHtml(message.message)}`;
            console.log(chatMessage);
            container.append(chatMessage);
        });


    $("#sendButton").click(function () {
        var message = $(".textarea").val();
        connection.invoke("Send", message, 'userId');
        $(".textarea").val("");
    });

    connection.start().catch(function (err) {
        return console.error(err.toString());
    });
    function escapeHtml(unsafe) {
        return unsafe
            .replace(/&/g, "&amp;")
            .replace(/</g, "&lt;")
            .replace(/>/g, "&gt;")
            .replace(/"/g, "&quot;")
            .replace(/'/g, "&#039;");
    }
</script>