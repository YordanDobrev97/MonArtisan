@model GetAllProjectsViewModel<ClientProjectsViewModel>

@{
    Layout = "_ClientsLayout";
}


@if (Model.ReciveNotifications)
{
    <span id="client-notifications">Vous avez des notifications</span>
    <a class="link-notifications" asp-area="" asp-controller="Clients" asp-action="Notifications">Plus de détails</a>
}

<section class="content">
    <h1 class="title">Bonjour prénom,</h1>

    <p id="message-paragraph"></p>
    <article class="client-projects">
        <h2>Projets</h2>
        <table>
            <tr>
                <th>ID</th>
                <th>NOM DU PROJET</th>
                <th>DATE</th>
                <th>Professionnel</th>
                <th>STATUT</th>
                <th>TRACKING</th>
            </tr>

            @foreach (var project in Model.Projects)
            {
                <tr>
                    <td>
                        <label class="container">
                            @project.Id
                            <form method="post">
                            </form>
                            @if (project.Status)
                            {
                                <input type="checkbox" checked onclick="handleProject(@project.Id)">
                            }
                            else
                            {
                                <input type="checkbox" onclick="handleProject(@project.Id)">
                            }
                            <span class="checkmark"></span>
                        </label>
                    </td>
                    <td>@project.Name</td>
                    <td>@project.Date</td>
                    <td>Nom</td>
                    <td>Delivered</td>
                    <td>IN332942</td>
                </tr>
            }
        </table>
        <ul class="pagination">
            @{
                List<int> pagesToShow = new List<int>();

                for (int i = 1; i <= Model.Pages; i++)
                {
                    pagesToShow.Add(i);
                }

                for (int i = 0; i < pagesToShow.Count; i++)
                {
                    var pageNumber = pagesToShow[i];

                    <li class="page-item">
                        <a class="page-link"
                           asp-area=""
                           asp-controller="Clients"
                           asp-action="Index"
                           asp-route-pageNumber="@pageNumber">
                            @pageNumber
                        </a>
                    </li>
                }
            }
        </ul>
    </article>
</section>

<article class="create-project">
    <button class="plus-button">
        <i class="fa fa-plus"></i>
    </button>

    <div class="new-project">
        <a asp-controller="Projects" asp-action="Index">Publier un nouveau projet</a>
    </div>
</article>

<script>
    function handleProject(id) {
        const token = $('input[name=__RequestVerificationToken]').val();
        const data = {
            projectId: id,
        };

        $.ajax({
            url: '/api/projects/finishProject',
            type: 'post',
            headers: {
                "X-CSRF": token,
            },
            data: JSON.stringify(data),
            contentType: 'application/json',
            success: function (result) {
                const messageP = document.getElementById('message-paragraph');
                if (result) {
                    messageP.textContent = 'The project was marked as completed'
                } else {
                    messageP.textContent = 'The project was marked as not completed'
                }
                $('#message-paragraph').show();

                setTimeout(function () {
                    $('#message-paragraph').hide();
                }, 2000);
            }
        });
    }
</script>